<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MBTI äººæ ¼æ¸¬é©— - éå¹´ç‰ˆ | CNY MBTI Quiz</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <!-- Remix Icon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                    },
                    colors: {
                        cny: {
                            red: '#e63946',
                            darkred: '#9a031e',
                            gold: '#f5cb5c',
                            darkgold: '#b58900',
                            bg: '#fdfbf7'
                        }
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(230, 57, 70, 0.15)',
                        'card': '0 20px 40px -10px rgba(0,0,0,0.1)',
                    }
                }
            }
        }
    </script>

    <!-- App Logic -->
    <script>
        function mbtiApp() {
            return {
                screen: 'start', // start, quiz, result
                currentIndex: 0,
                showTutorial: true,
                answers: [], // ç´€éŒ„é¸æ“‡ A(å·¦) æˆ– B(å³)
                resultType: 'INTJ', // é è¨­çµæœ
                
                // æ»‘å‹•ç‰©ç†ç‹€æ…‹
                isDragging: false,
                startX: 0,
                startY: 0,
                dragX: 0,
                dragY: 0,
                isAnimatingOut: false, // åˆ¤æ–·æ˜¯å¦æ­£åœ¨é£›å‡º
                leaveX: 0,
                leaveY: 0,

                questions: [
                    // E/I
                    { q: 'éå¹´åˆ°è¦ªæˆšå®¶ï¼Œä¸€é€²é–€ä½ æœƒ...', a: 'ä¸»å‹•è·Ÿæ¯å€‹äººæ‰“æ‹›å‘¼ï¼Œç†±æƒ…èŠå¤©', b: 'å®‰éœé»é ­å¾®ç¬‘ï¼Œç­‰åˆ¥äººä¾†è·Ÿä½ èªªè©±', dim: 'EI' },
                    { q: 'é•·è¼©å€‘åœ¨å®¢å»³èŠå¤©æ™‚ï¼Œä½ é€šå¸¸...', a: 'åŠ å…¥è©±é¡Œï¼Œåˆ†äº«è‡ªå·±çš„æ•…äº‹', b: 'åœ¨æ—é‚Šè½ï¼Œå¶çˆ¾å›æ‡‰å¹¾å¥', dim: 'EI' },
                    { q: 'éå¹´èšæœƒçµæŸå¾Œï¼Œä½ çš„æ„Ÿè¦ºæ˜¯...', a: 'å¾ˆé–‹å¿ƒï¼Œè¦ºå¾—å……æ»¿èƒ½é‡', b: 'æœ‰é»ç´¯ï¼Œéœ€è¦ç¨è™•å……é›»', dim: 'EI' },
                    { q: 'è¦ªæˆšæè­°ç©æ¡ŒéŠæˆ–å”± KTVï¼Œä½ æœƒ...', a: 'èˆˆå¥®åœ°ç¬¬ä¸€å€‹èˆ‰æ‰‹åƒåŠ ', b: 'å©‰è½‰æ¨è¾­ï¼Œæˆ–æ‰¾å®‰éœè§’è½å¾…è‘—', dim: 'EI' },
                    // S/N
                    { q: 'é•·è¼©å•ä½ ä»Šå¹´çš„è¨ˆç•«ï¼Œä½ æœƒ...', a: 'èªªå…·é«”ç›®æ¨™ï¼šè€ƒè­‰ç…§ã€å­˜å¤šå°‘éŒ¢', b: 'èªªå¤§æ–¹å‘ï¼šæ¢ç´¢æ–°é ˜åŸŸã€è¿½æ±‚å¤¢æƒ³', dim: 'SN' },
                    { q: 'åƒå¹´å¤œé£¯æ™‚ï¼Œä½ æœ€æ³¨æ„çš„æ˜¯...', a: 'èœè‰²çš„å‘³é“ã€æ“ºç›¤ã€èª°åšçš„', b: 'é€™é “é£¯çš„æ°›åœã€è±¡å¾µæ„ç¾©ã€å‚³çµ±', dim: 'SN' },
                    { q: 'è½è¦ªæˆšèªªæ•…äº‹æ™‚ï¼Œä½ æœƒ...', a: 'é—œæ³¨ç´°ç¯€ï¼šæ™‚é–“ã€åœ°é»ã€èª°åœ¨å ´', b: 'æ€è€ƒèƒŒå¾Œçš„æ„ç¾©å’Œå¯èƒ½çš„ç™¼å±•', dim: 'SN' },
                    { q: 'æ”¶åˆ°ç´…åŒ…æ™‚ï¼Œä½ æƒ³åˆ°çš„æ˜¯...', a: 'é‡‘é¡å¤šå°‘ã€è¦å­˜èµ·ä¾†é‚„æ˜¯èŠ±æ‰', b: 'é•·è¼©çš„å¿ƒæ„ã€é€™ä»½ç¥ç¦çš„æ„ç¾©', dim: 'SN' },
                    // T/F
                    { q: 'è¦ªæˆšå°å­©åµæ¶ï¼Œä½ æœƒ...', a: 'åˆ†æèª°å°èª°éŒ¯ï¼Œè¬›é“ç†çµ¦ä»–å€‘è½', b: 'å®‰æ’«é›™æ–¹æƒ…ç·’ï¼Œè®“å¤§å®¶å’Œå¥½', dim: 'TF' },
                    { q: 'é•·è¼©æŠ±æ€¨èº«é«”ä¸èˆ’æœï¼Œä½ æœƒ...', a: 'å»ºè­°çœ‹é†«ç”Ÿã€åšæª¢æŸ¥ã€èª¿æ•´ä½œæ¯', b: 'é—œå¿ƒä»–çš„æ„Ÿå—ï¼Œé™ªä¼´å‚¾è½', dim: 'TF' },
                    { q: 'åšæ±ºå®šæ™‚ï¼ˆä¾‹å¦‚è¦å»å“ªç©ï¼‰ï¼Œä½ å‚¾å‘...', a: 'æ¯”è¼ƒå„ªç¼ºé»ï¼Œé¸æœ€åˆç†çš„', b: 'è€ƒæ…®å¤§å®¶æ„Ÿå—ï¼Œé¸å¤šæ•¸äººé–‹å¿ƒçš„', dim: 'TF' },
                    { q: 'è¦ªæˆšæ‰¹è©•ä½ æ™‚ï¼Œä½ çš„åæ‡‰æ˜¯...', a: 'æƒ³ï¼šæœ‰é“ç†å—ï¼Ÿæˆ‘è©²æ”¹é€²å—ï¼Ÿ', b: 'æƒ³ï¼šä»–ç‚ºä»€éº¼é€™æ¨£èªªï¼Ÿæˆ‘åšéŒ¯äº†ä»€éº¼ï¼Ÿ', dim: 'TF' },
                    // J/P
                    { q: 'éå¹´æ‹œè¨ªè¡Œç¨‹ï¼Œä½ å–œæ­¡...', a: 'äº‹å…ˆè¦åŠƒå¥½ï¼šå¹¾é»åˆ°ã€å¾…å¤šä¹…', b: 'éš¨èˆˆå®‰æ’ï¼šçœ‹ç•¶ä¸‹å¿ƒæƒ…æ±ºå®š', dim: 'JP' },
                    { q: 'æº–å‚™éå¹´ç¦®ç‰©æ™‚ï¼Œä½ æœƒ...', a: 'æ—©æ—©åˆ—æ¸…å–®è²·å¥½ï¼Œæª¢æŸ¥æ²’éºæ¼', b: 'æ¥è¿‘éå¹´æ‰é–‹å§‹ï¼Œé‚Šæƒ³é‚Šè²·', dim: 'JP' },
                    { q: 'è¦ªæˆšæè­°è‡¨æ™‚æ”¹è¡Œç¨‹ï¼Œä½ æœƒ...', a: 'æœ‰é»ä¸ç¿’æ…£ï¼Œå¸Œæœ›ç…§åŸè¨ˆç•«', b: 'è¦ºå¾—æ²’é—œä¿‚ï¼Œåæ­£æœ‰å½ˆæ€§', dim: 'JP' },
                    { q: 'æ•´ç†éå¹´æ”¶åˆ°çš„æ±è¥¿ï¼Œä½ æœƒ...', a: 'ç•¶å¤©åˆ†é¡æ”¶å¥½ï¼Œæ”¾åˆ°å›ºå®šä½ç½®', b: 'å…ˆæ”¾è‘—ï¼Œä¹‹å¾Œæœ‰ç©ºå†æ…¢æ…¢æ•´ç†', dim: 'JP' }
                ],

                mbtiData: {
                    'INTJ': { title: 'ç­–ç•¥è¦åŠƒè€…', en: 'Strategic Planner', desc: 'ä½ æ˜¯éå¹´èšæœƒçš„å¹•å¾Œè»å¸«ã€‚ä¸æ„›å–§é¬§ï¼Œä½†èƒ½ç†æ€§åˆ†æè¦ªæˆšé—œä¿‚ï¼Œè¦åŠƒæœ€æœ‰æ•ˆç‡çš„æ‹œè¨ªè·¯ç·šã€‚å°å‚³çµ±ç¦®ä¿—æœ‰ç¨åˆ°è¦‹è§£ã€‚' },
                    'INTP': { title: 'å¥½å¥‡è§€å¯Ÿè€…', en: 'Curious Observer', desc: 'èšæœƒä¸­çš„å®‰éœè§€å¯Ÿå®¶ã€‚å°é•·è¼©æ•…äº‹å……æ»¿å¥½å¥‡ï¼Œå–œæ­¡åˆ†æå®¶æ—è¶£äº‹èƒŒå¾Œçš„é‚è¼¯ã€‚é‡åˆ°æ„Ÿèˆˆè¶£çš„è©±é¡Œå°±èƒ½æ»”æ»”ä¸çµ•ã€‚' },
                    'ENTJ': { title: 'å®¶æ—ç¸½æŒ‡æ®', en: 'Family Organizer', desc: 'å¤©ç”Ÿçš„èšæœƒé ˜å°è€…ã€‚æ“…é•·å”èª¿æ™‚é–“ã€å®‰æ’æµç¨‹ï¼Œç¢ºä¿æ¯å€‹ç’°ç¯€é †åˆ©ã€‚ä½ çš„æœæ–·å’Œæ•ˆç‡è®“é•·è¼©å€‘éƒ½å¾ˆæ”¾å¿ƒã€‚' },
                    'ENTP': { title: 'è©±é¡Œè£½é€ æ©Ÿ', en: 'Debate Starter', desc: 'å–œæ­¡æ‹‹å‡ºæ–°è§€é»æŒ‘æˆ°å‚³çµ±ï¼ŒæŠŠé£¯æ¡Œè®Šè¾¯è«–å ´ã€‚é›–ç„¶æœ‰æ™‚è®“é•·è¼©å‚»çœ¼ï¼Œä½†ç¸½èƒ½ç‚ºæ–°å¹´å¸¶ä¾†æ–°é®®çš„æ€è€ƒè§’åº¦ã€‚' },
                    'INFJ': { title: 'å®‰éœè«®è©¢å¸«', en: 'Quiet Counselor', desc: 'å®¶æ—çš„å¿ƒéˆå°å¸«ã€‚å–„æ–¼å‚¾è½å¿ƒäº‹ï¼Œçµ¦äºˆæº«æš–å»ºè­°ã€‚é›–ç„¶ä¸æ„›å–§é¬§ï¼Œä½†æ·±åˆ»ç†è§£æ¯å€‹äººçš„æ„Ÿå—ï¼Œæ˜¯æƒ…ç·’é¿é¢¨æ¸¯ã€‚' },
                    'INFP': { title: 'å¤¢å¹»æ•…äº‹å®¶', en: 'Dreamy Storyteller', desc: 'èšæœƒçš„æµªæ¼«éˆé­‚ã€‚å°å®¶æ—æ•…äº‹å……æ»¿æƒ³åƒï¼Œå–œæ­¡å¾å¹³å‡¡äº’å‹•çœ‹è¦‹æ·±å±¤æ„ç¾©ã€‚å¯èƒ½èº²åœ¨è§’è½ç”¨ç¨ç‰¹è¦–è§’è¨˜éŒ„éå¹´å›æ†¶ã€‚' },
                    'ENFJ': { title: 'å’Œè«§æ°£æ°›å¤§å¸«', en: 'Harmonious Host', desc: 'æ°›åœè£½é€ è€…ï¼æ“…é•·ç…§é¡§æ¯å€‹äººçš„æ„Ÿå—ï¼Œè®“æ‰€æœ‰äººéƒ½æ„Ÿåˆ°è¢«é‡è¦–ã€‚ä½ çš„ç†±æƒ…å’ŒåŒç†å¿ƒæ˜¯å®¶æ—å’Œè«§çš„é—œéµã€‚' },
                    'ENFP': { title: 'ç¤¾äº¤èŠ±è´è¶', en: 'Social Butterfly', desc: 'éå¹´çš„å¿«æ¨‚æ³‰æºï¼å……æ»¿æ´»åŠ›èˆ‡å‰µæ„ï¼Œç¸½èƒ½è®“èšæœƒè®Šæœ‰è¶£ã€‚å¾å°å­©åˆ°é•·è¼©éƒ½å–œæ­¡ä½ ï¼Œå› ç‚ºä½ èƒ½è®“æ¯å€‹äººé–‹å¿ƒã€‚' },
                    'ISTJ': { title: 'å‚³çµ±å®ˆè­·è€…', en: 'Traditional Guardian', desc: 'å®¶æ—å‚³çµ±çš„å®ˆè­·è€…ã€‚é‡è¦–ç¦®ç¯€ã€æº–æ™‚ã€è¦çŸ©ï¼Œç¢ºä¿éå¹´ç¿’ä¿—ä¸€å€‹ä¸æ¼ã€‚ä½ çš„å¯é å’ŒèªçœŸè®“é•·è¼©å€‘éƒ½å¾ˆå®‰å¿ƒã€‚' },
                    'ISFJ': { title: 'è²¼å¿ƒç…§é¡§è€…', en: 'Caring Host', desc: 'æœ€è²¼å¿ƒçš„å®¶æ—æˆå“¡ã€‚é»˜é»˜è¨˜å¾—æ¯å€‹äººçš„å–œå¥½ï¼Œæº–å‚™è²¼å¿ƒç¦®ç‰©ã€‚é›–ç„¶ä½èª¿ï¼Œä½†ä½ çš„ç´°å¿ƒè®“æ¯å€‹äººéƒ½æ„Ÿåˆ°æº«æš–ã€‚' },
                    'ESTJ': { title: 'é«˜æ•ˆå”èª¿è€…', en: 'Efficient Coordinator', desc: 'èšæœƒçš„å¯¦å‹™åŸ·è¡Œè€…ã€‚æ“…é•·åˆ†é…å·¥ä½œã€æŒæ§æ™‚é–“ï¼Œç¢ºä¿ä¸€åˆ‡æŒ‰è¨ˆç•«é€²è¡Œã€‚æ•ˆç‡å’Œè²¬ä»»æ„Ÿæ˜¯å®¶æ—æ´»å‹•çš„æ”¯æŸ±ã€‚' },
                    'ESFJ': { title: 'è¦ªæƒ…é€£çµè€…', en: 'Caring Connector', desc: 'å®¶æ—çš„æƒ…æ„Ÿä¸­å¿ƒã€‚ç†±å¿ƒç…§é¡§æ¯å€‹äººï¼Œç©æ¥µç¶­ç¹«è¦ªæˆšé–“çš„é—œä¿‚ã€‚ä½ çš„ç†±æƒ…å’Œé—œæ‡·è®“æ¯å€‹äººéƒ½æ„Ÿåˆ°è¢«æ„›ã€‚' },
                    'ISTP': { title: 'å¯¦ç”¨è§£æ±ºè€…', en: 'Problem Solver', desc: 'èšæœƒçš„å¯¦ç”¨å¹«æ‰‹ã€‚ç•¶é›»å™¨å£äº†ã€æ±è¥¿çµ„è£ä¸èµ·ä¾†ï¼Œä½ ç¸½èƒ½å†·éœæå®šã€‚é›–ç„¶è©±ä¸å¤šï¼Œä½†é—œéµæ™‚åˆ»æœ€å¯é ã€‚' },
                    'ISFP': { title: 'ç¾æ„Ÿå‰µé€ è€…', en: 'Artistic Decorator', desc: 'èšæœƒçš„ç¾æ„Ÿæ“”ç•¶ã€‚å–œæ­¡ç”¨é®®èŠ±ã€æ“ºé£¾è®“ç’°å¢ƒæ›´ç¾ï¼Œæˆ–ç”¨ç¾é£ŸéŸ³æ¨‚ç‡Ÿé€ æ°›åœã€‚ä½ çš„è—è¡“å¤©ä»½è®“éå¹´æ›´æœ‰è³ªæ„Ÿã€‚' },
                    'ESTP': { title: 'æ´»åŠ›éŠæˆ²ç‹', en: 'Game Master', desc: 'èšæœƒçš„æ´»åŠ›å¼•æ“ï¼æ“…é•·å¸¶å‹•æ°£æ°›ï¼Œæè­°å„ç¨®å¥½ç©çš„æ´»å‹•ã€‚ä½ çš„è¡Œå‹•åŠ›å’Œå¹½é»˜æ„Ÿè®“éå¹´æ°¸é ä¸ç„¡èŠã€‚' },
                    'ESFP': { title: 'å…¨å ´ç„¦é»æ˜æ˜Ÿ', en: 'Entertainer', desc: 'èšæœƒçš„ç„¦é»æ˜æ˜Ÿï¼æ„›è¡¨æ¼”ã€æ„›æç¬‘ï¼Œç¸½èƒ½é€—å¤§å®¶é–‹å¿ƒã€‚ä½ çš„ç†±æƒ…å’Œè¡¨ç¾åŠ›è®“éå¹´å……æ»¿æ­¡ç¬‘å’Œé›£å¿˜å›æ†¶ã€‚' }
                },

                initApp() {
                    // å…¨å±€æ»‘å‹•äº‹ä»¶ç›£è½
                    document.addEventListener('mousemove', (e) => this.onDrag(e));
                    document.addEventListener('mouseup', () => this.endDrag());
                    document.addEventListener('touchmove', (e) => this.onDrag(e), { passive: false });
                    document.addEventListener('touchend', () => this.endDrag());
                },

                startQuiz() {
                    this.screen = 'quiz';
                    window.scrollTo(0,0);
                },

                // è™•ç†å¡ç‰‡æ¨£å¼å‹•æ…‹è¨ˆç®— (å †ç–Šã€æ—‹è½‰ã€ä½ç§»)
                getCardStyle(index) {
                    if (index === this.currentIndex) {
                        // ç•¶å‰å¡ç‰‡
                        if (this.isAnimatingOut) {
                            return `transform: translate(${this.leaveX}px, ${this.leaveY}px) rotate(${this.leaveX / 15}deg); opacity: 0; transition: all 0.4s ease-out;`;
                        }
                        if (this.isDragging) {
                            return `transform: translate(${this.dragX}px, ${this.dragY}px) rotate(${this.dragX / 20}deg); transition: none;`;
                        }
                        return `transform: translate(0px, 0px) rotate(0deg); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);`;
                    } else if (index === this.currentIndex + 1) {
                        // ä¸‹ä¸€å¼µå¡ç‰‡ (ç¸®å°ä¸¦åœ¨å¾Œæ–¹)
                        const scale = this.isDragging ? 0.95 + (Math.abs(this.dragX) / 1000) : 0.95;
                        const finalScale = Math.min(scale, 1);
                        return `transform: scale(${finalScale}) translateY(15px); opacity: 1; transition: transform 0.3s ease-out;`;
                    }
                    return 'display: none;';
                },

                // æ‹–æ›³é‚è¼¯
                startDrag(e) {
                    if (this.isAnimatingOut) return;
                    this.isDragging = true;
                    this.startX = e.type.includes('mouse') ? e.pageX : e.touches[0].pageX;
                    this.startY = e.type.includes('mouse') ? e.pageY : e.touches[0].pageY;
                },

                onDrag(e) {
                    if (!this.isDragging) return;
                    
                    const currentX = e.type.includes('mouse') ? e.pageX : e.touches[0].pageX;
                    const currentY = e.type.includes('mouse') ? e.pageY : e.touches[0].pageY;
                    
                    this.dragX = currentX - this.startX;
                    this.dragY = currentY - this.startY;

                    // é˜²æ­¢æ‰‹æ©Ÿç«¯æ‹–æ›³å¡ç‰‡æ™‚é é¢æ»¾å‹•
                    if (e.type.includes('touch') && Math.abs(this.dragX) > Math.abs(this.dragY)) {
                        e.preventDefault();
                    }
                },

                endDrag() {
                    if (!this.isDragging) return;
                    this.isDragging = false;
                    
                    const threshold = window.innerWidth * 0.25; // è¢å¹•å¯¬åº¦ 25% ç‚ºé–¾å€¼
                    
                    if (this.dragX > threshold) {
                        this.triggerSwipe('right');
                    } else if (this.dragX < -threshold) {
                        this.triggerSwipe('left');
                    } else {
                        // æœªé”é–¾å€¼ï¼Œå½ˆå›åŸä½
                        this.dragX = 0;
                        this.dragY = 0;
                    }
                },

                // æŒ‰éˆ•é»æ“Šæˆ–æ»‘å‹•è§¸ç™¼
                handleAction(direction) {
                    if (this.isAnimatingOut) return;
                    this.triggerSwipe(direction);
                },

                triggerSwipe(direction) {
                    this.isAnimatingOut = true;
                    this.leaveX = direction === 'left' ? -window.innerWidth : window.innerWidth;
                    this.leaveY = this.dragY + (Math.random() * 100 - 50); // åŠ ä¸Šä¸€é»éš¨æ©Ÿï¼¹è»¸å¢åŠ è‡ªç„¶æ„Ÿ
                    
                    // è¨˜éŒ„ç­”æ¡ˆ (Left = A, Right = B)
                    this.answers[this.currentIndex] = direction === 'left' ? 'A' : 'B';

                    setTimeout(() => {
                        this.nextQuestion();
                    }, 300); // ç­‰å¾…é£›å‡ºå‹•ç•«å®Œæˆ
                },

                nextQuestion() {
                    this.isAnimatingOut = false;
                    this.dragX = 0;
                    this.dragY = 0;
                    this.leaveX = 0;
                    this.leaveY = 0;
                    
                    if (this.currentIndex < 15) {
                        this.currentIndex++;
                    } else {
                        this.calculateResult();
                    }
                },

                prevQuestion() {
                    if (this.currentIndex > 0) {
                        this.currentIndex--;
                        this.dragX = 0;
                        this.dragY = 0;
                    }
                },

                calculateResult() {
                    let scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
                    
                    this.answers.forEach((ans, idx) => {
                        const dim = this.questions[idx].dim;
                        if (ans === 'A') scores[dim[0]]++;
                        else if (ans === 'B') scores[dim[1]]++;
                    });

                    const type = 
                        (scores.E >= scores.I ? 'E' : 'I') +
                        (scores.S >= scores.N ? 'S' : 'N') +
                        (scores.T >= scores.F ? 'T' : 'F') +
                        (scores.J >= scores.P ? 'J' : 'P');

                    this.resultType = type;
                    this.screen = 'result';
                    
                    // è§¸ç™¼æ…¶ç¥ç´™å±‘å‹•ç•«
                    this.$nextTick(() => {
                        this.fireConfetti();
                    });
                },

                fireConfetti() {
                    var duration = 3000;
                    var end = Date.now() + duration;

                    (function frame() {
                        confetti({
                            particleCount: 5,
                            angle: 60,
                            spread: 55,
                            origin: { x: 0 },
                            colors: ['#e63946', '#f5cb5c', '#ffffff']
                        });
                        confetti({
                            particleCount: 5,
                            angle: 120,
                            spread: 55,
                            origin: { x: 1 },
                            colors: ['#e63946', '#f5cb5c', '#ffffff']
                        });

                        if (Date.now() < end) {
                            requestAnimationFrame(frame);
                        }
                    }());
                },

                shareResult() {
                    const text = `ğŸ‰ æˆ‘çš„éå¹´ MBTI äººæ ¼æ˜¯ã€${this.resultType} - ${this.mbtiData[this.resultType].title}ã€‘ï¼\nå¿«ä¾†æ¸¬æ¸¬ä½ çš„å°ˆå±¬éå¹´äººæ ¼ ğŸ‘‰`;
                    if (navigator.share) {
                        navigator.share({
                            title: 'MBTI äººæ ¼æ¸¬é©— - éå¹´ç‰ˆ',
                            text: text,
                            url: window.location.href
                        }).catch(console.error);
                    } else {
                        navigator.clipboard.writeText(text + ' ' + window.location.href).then(() => {
                            alert('çµæœå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼å¯ä»¥å»è²¼çµ¦æœ‹å‹å›‰ï½');
                        });
                    }
                },

                resetQuiz() {
                    this.currentIndex = 0;
                    this.answers = [];
                    this.screen = 'start';
                    this.showTutorial = true;
                    window.scrollTo(0,0);
                }
            }
        }
    </script>

    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            background-color: #fdfbf7;
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(230, 57, 70, 0.05), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(245, 203, 92, 0.08), transparent 25%);
            overflow-x: hidden;
            touch-action: pan-y; /* å…è¨±å‚ç›´æ»¾å‹•ï¼Œä½†åœ¨å¡ç‰‡ä¸Šç”± JS æ¥ç®¡æ°´å¹³ */
        }

        /* æµ®å‹•èƒŒæ™¯è£é£¾ */
        .bg-ornament {
            position: fixed;
            z-index: -1;
            opacity: 0.15;
            user-select: none;
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        /* ç»ç’ƒæ“¬ç‰©åŒ–å¡ç‰‡ */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: var(--tw-shadow-glass);
        }

        /* æ¸¬é©—å¡ç‰‡å †ç–Š */
        .card-stack {
            position: relative;
            width: 100%;
            max-width: 380px;
            height: 480px;
            margin: 0 auto;
            perspective: 1000px;
        }

        .swipe-card {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: white;
            border-radius: 1.5rem;
            box-shadow: var(--tw-shadow-card);
            border: 2px solid #fff;
            display: flex;
            flex-direction: column;
            transform-origin: 50% 100%;
            will-change: transform, opacity;
            touch-action: none; 
            user-select: none;
        }

        /* çµæœé å‹•æ…‹æ¼¸å±¤å­— */
        .text-gradient-gold {
            background: linear-gradient(135deg, #b58900 0%, #f5cb5c 50%, #b58900 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* éš±è—æœªè¼‰å…¥çš„å…ƒç´  */
        [x-cloak] { display: none !important; }
        
        /* é¸é …æŒ‰éˆ•äº’å‹•ç‰¹æ•ˆ */
        .option-badge {
            transition: all 0.2s ease;
        }
        .option-badge:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="min-h-screen text-gray-800 antialiased font-sans selection:bg-cny-gold selection:text-white" x-data="mbtiApp()" x-init="initApp()">

    <!-- èƒŒæ™¯æµ®å‹•è£é£¾ -->
    <div class="bg-ornament text-6xl" style="top: 10%; left: 5%; animation-delay: 0s;">ğŸ§§</div>
    <div class="bg-ornament text-5xl" style="top: 20%; right: 8%; animation-delay: 1s;">ğŸ®</div>
    <div class="bg-ornament text-6xl" style="bottom: 15%; left: 10%; animation-delay: 2s;">ğŸŠ</div>
    <div class="bg-ornament text-5xl" style="bottom: 25%; right: 5%; animation-delay: 1.5s;">ğŸ§¨</div>

    <main class="max-w-md mx-auto min-h-screen flex flex-col px-4 py-8 relative z-10">
        
        <!-- ================= é–‹å§‹ç•«é¢ ================= -->
        <div x-show="screen === 'start'" x-transition.opacity.duration.500ms class="flex-1 flex flex-col justify-center items-center">
            <div class="glass-panel rounded-3xl p-8 w-full text-center relative overflow-hidden">
                <!-- é ‚éƒ¨ç´…é‡‘é£¾æ¢ -->
                <div class="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-cny-red via-cny-gold to-cny-red"></div>
                
                <div class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-red-50 text-cny-red text-4xl mb-6 shadow-inner relative">
                    <span class="absolute inset-0 border-4 border-cny-red rounded-full opacity-20 animate-ping"></span>
                    <i class="ri-fire-fill"></i>
                </div>
                
                <h1 class="text-4xl font-black mb-2 text-gray-900 tracking-tight">MBTI äººæ ¼æ¸¬é©—</h1>
                <h2 class="text-2xl font-bold text-cny-darkgold mb-6">ğŸ® éå¹´é™å®šç‰ˆ ğŸ®</h2>
                
                <p class="text-gray-600 mb-8 leading-relaxed">
                    éå¹´æœŸé–“ï¼Œä½ æœƒæ˜¯ä»€éº¼æ¨£çš„äººï¼Ÿ<br>
                    é€é <b class="text-cny-red">16 å€‹æƒ…å¢ƒå•é¡Œ</b>ï¼Œ<br>
                    ç™¼æ˜ä½ çš„å°ˆå±¬æ–°å¹´äººæ ¼ï¼
                </p>

                <button @click="startQuiz()" 
                        class="w-full bg-gradient-to-r from-cny-red to-cny-darkred text-white py-4 rounded-2xl text-xl font-bold shadow-lg shadow-red-500/30 hover:shadow-red-500/50 hover:-translate-y-1 transition-all duration-300 flex items-center justify-center gap-2">
                    <i class="ri-play-circle-fill text-2xl"></i> ç«‹å³é–‹å§‹æ¸¬é©—
                </button>
                <p class="text-xs text-gray-400 mt-4">æ¸¬é©—æ™‚é–“ç´„ 3 åˆ†é˜</p>
            </div>
        </div>

        <!-- ================= æ¸¬é©—ç•«é¢ ================= -->
        <div x-show="screen === 'quiz'" x-cloak class="flex-1 flex flex-col">
            
            <!-- é ‚éƒ¨é€²åº¦æ¢ -->
            <div class="mb-8 mt-4">
                <div class="flex justify-between items-end mb-2">
                    <span class="text-sm font-bold text-gray-500">å•é¡Œ <span class="text-cny-red text-lg" x-text="currentIndex + 1"></span> / 16</span>
                    <span class="text-sm font-bold text-cny-darkgold" x-text="Math.round(((currentIndex) / 16) * 100) + '%'"></span>
                </div>
                <div class="h-3 w-full bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-cny-gold to-cny-red transition-all duration-500 ease-out"
                         :style="`width: ${((currentIndex) / 16) * 100}%`"></div>
                </div>
            </div>

            <!-- å¡ç‰‡æ»‘å‹•å€å¡Š -->
            <div class="card-stack flex-1" id="card-container">
                <template x-for="(q, index) in questions" :key="index">
                    <!-- åªæ¸²æŸ“ç•¶å‰å¡ç‰‡å’Œä¸‹ä¸€å¼µå¡ç‰‡ä»¥æå‡æ•ˆèƒ½ -->
                    <div x-show="index === currentIndex || index === currentIndex + 1"
                         class="swipe-card p-6 flex flex-col"
                         :class="{ 'z-20': index === currentIndex, 'z-10': index === currentIndex + 1 }"
                         :style="getCardStyle(index)"
                         @mousedown="index === currentIndex && startDrag($event)"
                         @touchstart="index === currentIndex && startDrag($event)">
                        
                        <!-- å¡ç‰‡å…§éƒ¨ -->
                        <div class="flex-1 flex flex-col justify-center relative pointer-events-none">
                            
                            <!-- æµ®æ°´å°æç¤º (Left/Right) -->
                            <div class="absolute top-0 left-0 w-full flex justify-between px-4 opacity-0 transition-opacity duration-200"
                                 :style="index === currentIndex ? `opacity: ${Math.min(Math.abs(dragX) / 100, 1)}` : ''">
                                <span class="text-2xl font-black text-cny-red border-4 border-cny-red rounded-xl px-4 py-1 transform -rotate-12"
                                      x-show="dragX < 0">é¸ A</span>
                                <span class="text-2xl font-black text-green-500 border-4 border-green-500 rounded-xl px-4 py-1 transform rotate-12"
                                      x-show="dragX > 0">é¸ B</span>
                            </div>

                            <div class="text-center mb-8">
                                <div class="w-12 h-12 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400">
                                    <i class="ri-question-mark"></i>
                                </div>
                                <h3 class="text-2xl font-bold text-gray-800 leading-snug" x-text="q.q"></h3>
                            </div>
                        </div>

                        <!-- å…©å€‹é¸é … (è¦–è¦ºå±•ç¤ºç”¨ï¼Œä¸»è¦é æ»‘å‹•æˆ–æŒ‰éˆ•æ“ä½œ) -->
                        <div class="space-y-3 pointer-events-none mb-4">
                            <div class="p-4 rounded-xl border-2 border-red-100 bg-red-50/50 flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-white border-2 border-cny-red text-cny-red flex items-center justify-center font-bold text-sm shrink-0 shadow-sm"><i class="ri-arrow-left-line"></i></div>
                                <span class="text-sm font-medium text-gray-700 leading-tight" x-text="q.a"></span>
                            </div>
                            <div class="p-4 rounded-xl border-2 border-green-100 bg-green-50/50 flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-white border-2 border-green-500 text-green-500 flex items-center justify-center font-bold text-sm shrink-0 shadow-sm"><i class="ri-arrow-right-line"></i></div>
                                <span class="text-sm font-medium text-gray-700 leading-tight" x-text="q.b"></span>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- åº•éƒ¨æ“ä½œå€ -->
            <div class="mt-8 flex justify-center items-center gap-8 mb-4">
                <button @click="handleAction('left')" class="option-badge w-16 h-16 rounded-full bg-white border-4 border-cny-red text-cny-red flex items-center justify-center shadow-lg hover:bg-red-50">
                    <i class="ri-close-line text-3xl"></i>
                </button>
                <button @click="prevQuestion()" x-show="currentIndex > 0" class="w-10 h-10 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center hover:bg-gray-200 transition-colors">
                    <i class="ri-arrow-go-back-line"></i>
                </button>
                <button @click="handleAction('right')" class="option-badge w-16 h-16 rounded-full bg-white border-4 border-green-500 text-green-500 flex items-center justify-center shadow-lg hover:bg-green-50">
                    <i class="ri-check-line text-3xl"></i>
                </button>
            </div>
            <p class="text-center text-gray-400 text-xs mb-4">å‘å·¦/å³æ»‘å‹•å¡ç‰‡ï¼Œæˆ–é»æ“ŠæŒ‰éˆ•é¸æ“‡</p>

            <!-- æ“ä½œæ•™å­¸ Overlay (åƒ…ç¬¬ä¸€é¡Œé¡¯ç¤º) -->
            <div x-show="currentIndex === 0 && showTutorial" x-transition.opacity class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4" @click="showTutorial = false">
                <div class="bg-white rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl relative">
                    <div class="absolute -top-6 left-1/2 -translate-x-1/2 w-12 h-12 bg-cny-gold text-white rounded-full flex items-center justify-center text-2xl border-4 border-white">ğŸ’¡</div>
                    <h3 class="text-xl font-bold mt-4 mb-6 text-gray-800">å¦‚ä½•æ“ä½œï¼Ÿ</h3>
                    <div class="flex justify-between items-center mb-8 px-4">
                        <div class="text-center">
                            <i class="ri-arrow-left-circle-fill text-4xl text-cny-red mb-2 block"></i>
                            <span class="text-sm font-bold">å‘å·¦æ»‘<br>é¸æ“‡ A</span>
                        </div>
                        <i class="ri-exchange-line text-3xl text-gray-300"></i>
                        <div class="text-center">
                            <i class="ri-arrow-right-circle-fill text-4xl text-green-500 mb-2 block"></i>
                            <span class="text-sm font-bold">å‘å³æ»‘<br>é¸æ“‡ B</span>
                        </div>
                    </div>
                    <button class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold">æˆ‘çŸ¥é“äº†</button>
                </div>
            </div>
        </div>

        <!-- ================= çµæœç•«é¢ ================= -->
        <div x-show="screen === 'result'" x-cloak x-transition.opacity.duration.800ms class="flex-1 flex flex-col items-center justify-center py-4">
            
            <h3 class="text-xl font-bold text-gray-500 mb-2">å°ˆå±¬æ–¼ä½ çš„éå¹´äººæ ¼æ˜¯...</h3>
            
            <!-- çµæœå¾½ç« å¡ç‰‡ (å–ä»£éœæ…‹åœ–ç‰‡) -->
            <div class="w-full bg-white rounded-3xl shadow-card overflow-hidden mb-8 border border-gray-100 relative group">
                <div class="absolute top-0 left-0 w-full h-32 bg-gradient-to-br from-cny-gold to-cny-red opacity-10"></div>
                
                <div class="p-8 text-center relative z-10">
                    <div class="w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-cny-red to-cny-darkred text-white flex items-center justify-center text-3xl font-black mb-4 shadow-lg border-4 border-white">
                        <span x-text="resultType"></span>
                    </div>
                    
                    <h1 class="text-4xl font-black text-gray-900 mb-1" x-text="mbtiData[resultType]?.title"></h1>
                    <p class="text-sm font-bold text-cny-darkgold mb-6 uppercase tracking-widest" x-text="mbtiData[resultType]?.en"></p>
                    
                    <div class="bg-orange-50 rounded-2xl p-6 text-left relative">
                        <i class="ri-double-quotes-l text-4xl absolute -top-3 -left-2 text-orange-200"></i>
                        <p class="text-gray-700 leading-relaxed text-sm md:text-base relative z-10" x-text="mbtiData[resultType]?.desc"></p>
                    </div>
                </div>
            </div>

            <div class="w-full space-y-3">
                <button @click="shareResult()" class="w-full bg-gray-900 text-white py-4 rounded-2xl text-lg font-bold shadow-lg hover:bg-gray-800 transition-colors flex justify-center items-center gap-2">
                    <i class="ri-share-forward-fill"></i> åˆ†äº«æ¸¬é©—çµæœ
                </button>
                <button @click="resetQuiz()" class="w-full bg-white text-gray-600 border-2 border-gray-200 py-4 rounded-2xl text-lg font-bold hover:bg-gray-50 transition-colors flex justify-center items-center gap-2">
                    <i class="ri-refresh-line"></i> å†æ¸¬ä¸€æ¬¡
                </button>
            </div>
        </div>

        <!-- é å°¾ -->
        <footer class="mt-auto pt-8 text-center text-xs text-gray-400 relative z-10 pb-4">
            <p>åƒ…ä¾›å¨›æ¨‚åƒè€ƒï¼Œç¥æ‚¨æ–°å¹´å¿«æ¨‚ï¼ğŸ§§</p>
        </footer>

    </main>
</body>
</html>